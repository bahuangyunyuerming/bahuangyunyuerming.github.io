<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>✨ 智能穿衣推荐系统 | 专属您的时尚顾问</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- 配置Tailwind -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#6366F1',
                        accent: '#EC4899',
                        dark: '#1F2937',
                        light: '#F9FAFB',
                        success: '#10B981',
                        warning: '#F59E0B',
                        danger: '#EF4444'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out',
                        'slide-up': 'slideUp 0.6s ease-out',
                        'pulse-slow': 'pulse 3s ease-in-out infinite',
                        'float': 'float 6s ease-in-out infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' }
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' }
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0px)' },
                            '50%': { transform: 'translateY(-10px)' }
                        }
                    }
                }
            }
        }
    </script>

    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .form-input-focus {
                @apply focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all duration-300;
            }
            .card-shadow {
                @apply shadow-lg hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1;
            }
            .btn-hover {
                @apply transition-all duration-300 hover:scale-105 active:scale-95;
            }
            .gradient-text {
                background: linear-gradient(90deg, #3B82F6, #EC4899);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
            }
            .blob-bg {
                position: absolute;
                width: 300px;
                height: 300px;
                border-radius: 50%;
                filter: blur(80px);
                z-index: -1;
                opacity: 0.3;
            }
            .blob-1 {
                background: #3B82F6;
                top: -100px;
                left: -100px;
                animation: float 8s ease-in-out infinite;
            }
            .blob-2 {
                background: #EC4899;
                bottom: -150px;
                right: -50px;
                animation: float 10s ease-in-out infinite;
            }
            .drag-over {
                @apply border-primary bg-primary/5;
            }
            .modal-image-transition {
                @apply transition-all duration-300 ease-in-out;
            }
            .input-label {
                @apply block text-sm font-medium text-gray-700 mb-1;
            }
            .input-field {
                @apply w-full px-3 py-2 border border-gray-300 rounded-lg form-input-focus group-hover:border-primary;
            }
            /* 新增：确保加载状态和图像重叠，加载状态默认显示，图像默认隐藏 */
            .image-loading-wrapper {
                @apply relative w-full h-full;
            }
        }

        /* 自定义动画 */
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes fadeOut {
            0% { opacity: 1; }
            100% { opacity: 0; }
        }

        .gradient-border {
            position: relative;
            border: 2px solid transparent;
            background: linear-gradient(135deg, #ffffff, #ffffff) padding-box,
                        linear-gradient(135deg, #3B82F6, #EC4899) border-box;
            border-radius: 0.5rem;
        }

        .gradient-glow {
            position: relative;
        }

        .gradient-glow::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #3B82F6, #EC4899, #3B82F6);
            background-size: 300% 300%;
            border-radius: 0.5rem;
            z-index: -1;
            animation: gradientShift 3s ease-in-out infinite;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }

        .gradient-glow:hover::before {
            opacity: 1;
        }

        .image-preview {
            transition: all 0.3s ease;
            cursor: zoom-in;
        }

        .image-preview:hover {
            transform: scale(1.02);
        }

        /* 三围输入区域动画 */
        #bust-waist-hips {
            transition: all 0.3s ease-out;
        }

        /* 图像加载状态样式优化：确保覆盖整个图像区域 */
        .image-state-container {
            @apply absolute inset-0 flex-col items-center justify-center backdrop-blur-sm bg-white/80 z-10;
        }
    </style>
</head>
<body class="bg-gray-50 font-sans text-gray-800 transition-colors duration-300">
    <!-- 背景装饰元素 -->
    <div class="blob-bg blob-1"></div>
    <div class="blob-bg blob-2"></div>

    <!-- 导航栏 -->
    <nav class="bg-white/80 backdrop-blur-md shadow-sm fixed w-full z-50 transition-all duration-300">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center animate-fade-in">
                    <div class="relative">
                        <i class="fa fa-tshirt text-primary text-2xl mr-2 transition-transform duration-300 hover:rotate-12"></i>
                        <div class="absolute -top-1 -right-1 w-2 h-2 bg-accent rounded-full animate-ping"></div>
                    </div>
                    <span class="text-xl font-bold gradient-text">穿搭助手</span>
                </div>
                <div class="flex items-center space-x-2">
                    <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-100 transition-all duration-300 transform hover:scale-110">
                        <i class="fa fa-moon-o text-gray-600 transition-transform duration-300"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- 主内容区 -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-28 pb-16 relative">
        <!-- 标题区域 -->
        <div class="text-center mb-12 animate-slide-up">
            <h1 class="text-[clamp(2rem,5vw,3.5rem)] font-bold text-gray-900 mb-4 leading-tight">
                <span class="block">智能穿衣推荐</span>
                <span class="text-primary/80 text-lg font-medium mt-2 block">您的专属时尚顾问</span>
            </h1>
            <p class="text-gray-600 max-w-2xl mx-auto text-lg leading-relaxed">
                <span class="inline-block animate-fade-in" style="animation-delay: 0.2s">输入您的身体数据、风格偏好和天气情况，</span>
                <span class="inline-block animate-fade-in" style="animation-delay: 0.4s">系统将为您生成最适合的穿搭方案与AI图像</span>
            </p>

            <!-- 装饰线条 -->
            <div class="w-24 h-1 bg-gradient-to-r from-primary to-accent mx-auto mt-6 rounded-full"></div>
        </div>

        <div class="grid md:grid-cols-5 gap-8">
            <!-- 左侧表单（保留原功能） -->
            <div class="md:col-span-2">
                <div class="bg-white rounded-xl shadow-md p-6 card-shadow border border-gray-100 animate-fade-in">
                    <h2 class="text-xl font-semibold mb-6 flex items-center">
                        <div class="w-8 h-8 bg-primary/10 rounded-lg flex items-center justify-center mr-3 transition-transform duration-300 hover:rotate-12">
                            <i class="fa fa-user-circle text-primary"></i>
                        </div>
                        <span>个人与环境信息</span>
                    </h2>

                    <form id="style-form" class="space-y-6">
                        <!-- 基本信息（含年龄） -->
                        <div class="space-y-4 p-4 bg-gray-50 rounded-lg animate-fade-in">
                            <h3 class="font-medium text-gray-700 flex items-center">
                                <i class="fa fa-info-circle text-primary mr-2"></i>
                                基本信息
                            </h3>

                            <!-- 性别选择：核心控制三围显隐 -->
                            <div class="animate-fade-in" style="animation-delay: 0.1s">
                                <label class="block text-sm font-medium text-gray-700 mb-2">性别 <span class="text-danger">*</span></label>
                                <div class="flex space-x-4">
                                    <label class="inline-flex items-center px-4 py-2 bg-white border-2 border-gray-200 rounded-lg cursor-pointer hover:border-primary transition-all duration-300 hover:shadow-md">
                                        <input type="radio" name="gender" value="male" class="form-radio h-5 w-5 text-primary" checked>
                                        <span class="ml-2 font-medium">男</span>
                                    </label>
                                    <label class="inline-flex items-center px-4 py-2 bg-white border-2 border-gray-200 rounded-lg cursor-pointer hover:border-primary transition-all duration-300 hover:shadow-md">
                                        <input type="radio" name="gender" value="female" class="form-radio h-5 w-5 text-primary">
                                        <span class="ml-2 font-medium">女</span>
                                    </label>
                                </div>
                            </div>

                            <!-- 身高、体重、年龄 -->
                            <div class="grid grid-cols-3 gap-4 animate-fade-in" style="animation-delay: 0.2s">
                                <!-- 身高 -->
                                <div class="group">
                                    <label for="height" class="input-label">身高 (cm) <span class="text-danger">*</span></label>
                                    <div class="relative">
                                        <input type="number" id="height" name="height" min="100" max="220" value="175" required
                                            class="input-field">
                                        <div class="absolute right-3 top-2 text-gray-400">
                                            <i class="fa fa-ruler-vertical"></i>
                                        </div>
                                    </div>
                                </div>
                                <!-- 体重 -->
                                <div class="group">
                                    <label for="weight" class="input-label">体重 (kg) <span class="text-danger">*</span></label>
                                    <div class="relative">
                                        <input type="number" id="weight" name="weight" min="30" max="200" value="68" required
                                            class="input-field">
                                        <div class="absolute right-3 top-2 text-gray-400">
                                            <i class="fa fa-weight"></i>
                                        </div>
                                    </div>
                                </div>
                                <!-- 年龄 -->
                                <div class="group">
                                    <label for="age" class="input-label">年龄 <span class="text-danger">*</span></label>
                                    <div class="relative">
                                        <input type="number" id="age" name="age" min="0" max="130" value="25" required
                                            class="input-field">
                                        <div class="absolute right-3 top-2 text-gray-400">
                                            <i class="fa fa-calendar"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 环境信息 -->
                        <div class="space-y-4 pt-2 p-4 bg-gray-50 rounded-lg animate-fade-in" style="animation-delay: 0.9s">
                            <h3 class="font-medium text-gray-700 flex items-center">
                                <i class="fa fa-cloud text-primary mr-2"></i>
                                环境信息
                            </h3>

                            <!-- 天气类型选择 -->
                            <div class="animate-fade-in" style="animation-delay: 1.0s">
                                <label class="block text-sm font-medium text-gray-700 mb-2">天气类型 <span class="text-danger">*</span></label>
                                <select id="weather-type" name="weatherType" class="w-full px-4 py-3 border border-gray-300 rounded-lg form-input-focus bg-white hover:border-primary transition-all duration-300" required>
                                    <option value="sunny" selected>晴天</option>
                                    <option value="cloudy">阴天</option>
                                    <option value="rainy">雨天</option>
                                    <option value="snowy">雪天</option>
                                    <option value="windy">大风天</option>
                                    <option value="foggy">雾天</option>
                                </select>
                            </div>

                            <!-- 温度输入 -->
                            <div class="animate-fade-in" style="animation-delay: 1.1s">
                                <label for="temperature" class="block text-sm font-medium text-gray-700 mb-2">温度 (℃) <span class="text-danger">*</span></label>
                                <div class="relative">
                                    <input type="number" id="temperature" name="temperature" min="-30" max="50" value="25" required
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg form-input-focus group-hover:border-primary transition-all duration-300">
                                    <div class="absolute right-3 top-3 text-gray-400">
                                        <i class="fa fa-thermometer-half"></i>
                                    </div>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">根据温度推荐衣物厚度（-30℃~50℃）</p>
                            </div>
                        </div>

                        <!-- 身形细节：含女性专属三围 -->
                        <div class="space-y-4 pt-2 p-4 bg-gray-50 rounded-lg animate-fade-in" style="animation-delay: 0.3s">
                            <h3 class="font-medium text-gray-700 flex items-center">
                                <i class="fa fa-search-plus text-primary mr-2"></i>
                                身形细节 <span class="text-xs text-gray-500 ml-2">(完善后推荐更精准)</span>
                            </h3>

                            <!-- 脸型选择或图片上传 -->
                            <div class="animate-fade-in" style="animation-delay: 0.4s">
                                <label class="block text-sm font-medium text-gray-700 mb-2">脸型</label>
                                <div class="mb-3">
                                    <select id="face-shape" name="face-shape" class="w-full px-4 py-3 border border-gray-300 rounded-lg form-input-focus bg-white hover:border-primary transition-all duration-300">
                                        <option value="">请选择脸型</option>
                                        <option value="round">圆脸</option>
                                        <option value="square">方脸</option>
                                        <option value="long">长脸</option>
                                        <option value="heart">心形脸</option>
                                        <option value="oval" selected>瓜子脸</option>
                                    </select>
                                </div>

                                <div class="text-sm font-medium text-gray-700 mb-2">或上传脸部照片（自动识别脸型）</div>
                                <!-- 拖放上传区域 -->
                                <div id="drop-area" class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-primary transition-colors duration-300">
                                    <input type="file" id="face-image" accept="image/*" class="hidden" />
                                    <label for="face-image" class="cursor-pointer">
                                        <div class="flex flex-col items-center justify-center">
                                            <i class="fa fa-upload text-gray-400 text-2xl mb-2"></i>
                                            <p class="text-gray-500 text-sm">点击上传照片或拖放至此处</p>
                                            <p class="text-gray-400 text-xs mt-1">支持 JPG, PNG 格式（≤10MB）</p>
                                        </div>
                                    </label>
                                </div>

                                <!-- 图片预览区域 -->
                                <div id="image-preview-container" class="mt-3 hidden">
                                    <div class="relative image-preview rounded-lg overflow-hidden border border-gray-200">
                                        <img id="image-preview" src="" alt="脸部预览" class="w-full h-auto max-h-48 object-cover">
                                        <button type="button" id="remove-image" class="absolute top-2 right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center hover:bg-red-600 transition-colors">
                                            <i class="fa fa-times text-xs"></i>
                                        </button>
                                        <div class="absolute bottom-0 left-0 right-0 bg-black/50 text-white text-xs py-1 text-center">
                                            点击查看完整图片
                                        </div>
                                    </div>
                                    <input type="hidden" id="face-image-base64" name="faceImageBase64">
                                    <input type="hidden" id="face-image-type" name="faceImageType">
                                </div>
                            </div>

                            <!-- 体型 -->
                            <div class="animate-fade-in" style="animation-delay: 0.5s">
                                <label for="body-type" class="block text-sm font-medium text-gray-700 mb-1">体型</label>
                                <select id="body-type" name="body-type" class="w-full px-4 py-3 border border-gray-300 rounded-lg form-input-focus bg-white hover:border-primary transition-all duration-300">
                                    <option value="">请选择</option>
                                    <option value="apple">苹果型</option>
                                    <option value="pear">梨型</option>
                                    <option value="hourglass">沙漏型</option>
                                    <option value="rectangle">矩形</option>
                                    <option value="inverted-triangle" selected>倒三角</option>
                                </select>
                            </div>

                            <!-- 三围（仅女性显示） -->
                            <div id="bust-waist-hips" class="hidden grid grid-cols-3 gap-3 animate-fade-in pt-2">
                                <div class="group">
                                    <label for="bust" class="input-label">胸围 (cm)</label>
                                    <input type="number" id="bust" name="bust" min="60" max="150" placeholder="如：88"
                                        class="input-field">
                                </div>
                                <div class="group">
                                    <label for="waist" class="input-label">腰围 (cm)</label>
                                    <input type="number" id="waist" name="waist" min="50" max="130" placeholder="如：66"
                                        class="input-field">
                                </div>
                                <div class="group">
                                    <label for="hips" class="input-label">臀围 (cm)</label>
                                    <input type="number" id="hips" name="hips" min="60" max="160" placeholder="如：90"
                                        class="input-field">
                                </div>
                                <div class="col-span-3 text-xs text-gray-500 mt-1">
                                    <i class="fa fa-info-circle mr-1"></i> 填写三围可提供更精准的身形适配信息
                                </div>
                            </div>
                        </div>

                        <!-- 风格偏好 -->
                        <div class="space-y-4 pt-2 p-4 bg-gray-50 rounded-lg animate-fade-in" style="animation-delay: 0.6s">
                            <h3 class="font-medium text-gray-700 flex items-center">
                                <i class="fa fa-paint-brush text-primary mr-2"></i>
                                风格偏好
                            </h3>

                            <div class="animate-fade-in" style="animation-delay: 0.7s">
                                <label for="style" class="block text-sm font-medium text-gray-700 mb-1">首选风格 <span class="text-danger">*</span></label>
                                <select id="style" name="style" class="w-full px-4 py-3 border border-gray-300 rounded-lg form-input-focus bg-white hover:border-primary transition-all duration-300" required>
                                    <option value="casual">休闲</option>
                                    <option value="formal">正式</option>
                                    <option value="street">街头</option>
                                    <option value="vintage">复古</option>
                                    <option value="minimalist">极简</option>
                                    <option value="sporty">运动</option>
                                    <option value="elegant">优雅</option>
                                </select>
                            </div>

                            <div class="animate-fade-in" style="animation-delay: 0.8s">
                                <label class="block text-sm font-medium text-gray-700 mb-3">场合 <span class="text-danger">*</span></label>
                                <div class="grid grid-cols-2 gap-3">
                                    <label class="inline-flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-all duration-300 hover:border-primary hover:shadow-md">
                                        <input type="checkbox" name="occasion" value="daily" class="form-checkbox h-5 w-5 text-primary" checked>
                                        <span class="ml-3 text-sm font-medium">日常</span>
                                    </label>
                                    <label class="inline-flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-all duration-300 hover:border-primary hover:shadow-md">
                                        <input type="checkbox" name="occasion" value="work" class="form-checkbox h-5 w-5 text-primary">
                                        <span class="ml-3 text-sm font-medium">工作</span>
                                    </label>
                                    <label class="inline-flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-all duration-300 hover:border-primary hover:shadow-md">
                                        <input type="checkbox" name="occasion" value="party" class="form-checkbox h-5 w-5 text-primary">
                                        <span class="ml-3 text-sm font-medium">聚会</span>
                                    </label>
                                    <label class="inline-flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-all duration-300 hover:border-primary hover:shadow-md">
                                        <input type="checkbox" name="occasion" value="date" class="form-checkbox h-5 w-5 text-primary">
                                        <span class="ml-3 text-sm font-medium">约会</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <button type="submit" class="w-full bg-gradient-to-r from-primary to-secondary hover:from-primary/90 hover:to-secondary/90 text-white font-medium py-4 px-6 rounded-lg transition-all duration-300 flex items-center justify-center btn-hover shadow-lg hover:shadow-xl">
                            <i class="fa fa-magic mr-2 animate-pulse-slow"></i>
                            <span class="text-lg font-semibold">获取专属推荐</span>
                            <i class="fa fa-arrow-right ml-2 transform transition-transform duration-300 group-hover:translate-x-1"></i>
                        </button>
                    </form>
                </div>
            </div>

            <!-- 右侧结果展示区（核心修复：图像加载状态控制） -->
            <div class="md:col-span-3">
                <div id="result-container" class="bg-white rounded-xl shadow-md p-6 h-full card-shadow border border-gray-100 relative overflow-hidden">
                    <!-- 装饰角标 -->
                    <div class="absolute top-0 right-0 w-24 h-24 bg-gradient-to-br from-primary to-accent opacity-10 rounded-bl-full"></div>

                    <!-- 初始状态 -->
                    <div id="initial-state" class="text-center py-16 relative">
                        <div class="absolute inset-0 bg-gradient-to-br from-primary/5 to-accent/5 rounded-xl"></div>
                        <div class="relative z-10">
                            <div class="w-32 h-32 bg-gradient-to-br from-primary/20 to-accent/20 rounded-full flex items-center justify-center mx-auto mb-6 animate-float">
                                <i class="fa fa-tshirt text-5xl text-primary/80"></i>
                            </div>
                            <h3 class="text-xl font-bold text-gray-800 mb-3">等待您的时尚信息</h3>
                            <p class="text-gray-600 max-w-md mx-auto text-lg">填写左侧表单（女性可补充三围），系统将为您生成个性化穿搭方案与AI图像</p>
                            <div class="w-16 h-1 bg-primary/30 mx-auto mt-6 rounded-full animate-pulse"></div>
                        </div>
                    </div>

                    <!-- 加载状态 -->
                    <div id="loading-state" class="text-center py-16 hidden relative">
                        <div class="absolute inset-0 bg-gradient-to-r from-primary/5 to-secondary/5 rounded-xl animate-pulse"></div>
                        <div class="relative z-10">
                            <div class="w-20 h-20 border-4 border-primary/30 border-t-primary rounded-full animate-spin mx-auto mb-6"></div>
                            <h3 class="text-xl font-semibold text-gray-800 mb-3">系统正在为您设计穿搭</h3>
                            <p class="text-gray-600">正在结合年龄、天气、身形（含三围）数据生成方案与图像...</p>
                            <div class="flex justify-center mt-6 space-x-2">
                                <div class="w-3 h-3 bg-primary rounded-full animate-bounce"></div>
                                <div class="w-3 h-3 bg-primary rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                                <div class="w-3 h-3 bg-primary rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                            </div>
                        </div>
                    </div>

                    <!-- 结果状态（核心修复：优化图像加载状态控制） -->
                    <div id="result-state" class="space-y-6 hidden">
                        <div class="flex items-center justify-between">
                            <h2 class="text-2xl font-bold mb-4 flex items-center">
                                <div class="w-8 h-8 bg-yellow-400/20 rounded-lg flex items-center justify-center mr-3">
                                    <i class="fa fa-star text-yellow-400"></i>
                                </div>
                                <span>为您精心推荐</span>
                            </h2>
                            <div class="text-sm text-gray-500 bg-gray-100 px-3 py-1 rounded-full">
                                <i class="fa fa-check-circle text-green-500 mr-1"></i> AI 生成
                            </div>
                        </div>

                        <!-- 推荐图片（核心修复：添加wrapper确保加载状态和图像重叠，JS精准控制显示隐藏） -->
                        <div class="rounded-xl overflow-hidden bg-gray-100 mb-6 relative group">
                            <div class="aspect-w-16 aspect-h-9 image-loading-wrapper">
                                <!-- 1. 图像加载中状态：默认显示，加载完成后隐藏 -->
                                <div id="outfit-image-loading" class="image-state-container flex">
                                    <div class="w-16 h-16 border-4 border-primary/30 border-t-primary rounded-full animate-spin mb-4"></div>
                                    <p class="text-sm text-gray-600">正在加载穿搭图像...</p>
                                </div>

                                <!-- 2. AI生成的图像：默认隐藏，加载完成后显示 -->
                                <img id="outfit-image" src="" alt="AI推荐穿搭" class="w-full h-auto object-cover transition-transform duration-500 group-hover:scale-105 hidden">
                            </div>
                            <div class="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                            <div class="absolute top-4 left-4 bg-white/90 backdrop-blur-sm px-3 py-1 rounded-full text-xs font-medium text-gray-700">
                                <i class="fa fa-camera mr-1"></i> AI 生成穿搭图
                            </div>
                        </div>

                        <!-- 穿搭说明（含三围适配） -->
                        <div class="animate-fade-in">
                            <h3 class="font-bold text-gray-800 mb-3 text-lg flex items-center">
                                <i class="fa fa-info-circle text-primary mr-2"></i> 穿搭说明
                            </h3>
                            <div id="outfit-description" class="prose prose-sm max-w-none text-gray-700 leading-relaxed bg-gray-50 p-4 rounded-lg">
                                <!-- 动态填充：含三围适配内容 -->
                            </div>
                        </div>

                        <!-- AI生成的穿搭方案原文 -->
                        <div class="animate-fade-in bg-purple-50 p-5 rounded-xl border border-purple-100">
                            <h3 class="font-bold text-purple-800 mb-3 flex items-center">
                                <div class="w-6 h-6 bg-purple-100 rounded-full flex items-center justify-center mr-2">
                                    <i class="fa fa-quote-left text-purple-600 text-xs"></i>
                                </div>
                                <span>AI 穿搭方案</span>
                            </h3>
                            <div id="ai-fashion-original" class="text-purple-900 text-sm leading-relaxed italic bg-white/50 p-3 rounded-lg">
                                <!-- 动态填充：Fashion_recommendations.py生成的原文 -->
                            </div>
                        </div>

                        <!-- 搭配要点 -->
                        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-5 rounded-xl border border-blue-100 animate-fade-in">
                            <h3 class="font-bold text-blue-800 mb-3 flex items-center">
                                <div class="w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center mr-2">
                                    <i class="fa fa-lightbulb-o text-blue-600"></i>
                                </div>
                                <span>搭配要点</span>
                            </h3>
                            <ul id="style-tips" class="list-none text-blue-700 space-y-2">
                                <!-- 动态填充：含三围适配技巧 -->
                            </ul>
                        </div>

                        <!-- 操作按钮 -->
                        <div class="flex flex-wrap gap-3 pt-4">
                            <button id="regenerate-btn" class="px-5 py-3 border border-primary text-primary rounded-lg hover:bg-primary/5 transition-all duration-300 flex items-center btn-hover gradient-glow">
                                <i class="fa fa-refresh mr-2"></i> 重新生成
                            </button>
                            <button id="save-btn" class="px-5 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 flex items-center btn-hover shadow-md">
                                <i class="fa fa-heart mr-2"></i> 保存搭配
                            </button>
                            <button id="share-btn" class="px-5 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 flex items-center btn-hover shadow-md">
                                <i class="fa fa-share-alt mr-2"></i> 分享
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 页脚 -->
    <footer class="bg-gradient-to-r from-gray-100 to-gray-200 py-12 relative overflow-hidden">
        <div class="absolute inset-0 bg-gradient-to-r from-primary/5 to-accent/5"></div>
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
            <div class="text-center">
                <div class="mb-6">
                    <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-r from-primary to-accent rounded-full mb-4">
                        <i class="fa fa-tshirt text-white text-2xl"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-2">智能穿衣推荐系统</h3>
                    <p class="text-gray-600 max-w-2xl mx-auto">让每个人都能轻松找到适合自己的穿搭，展现独特魅力</p>
                </div>
                <div class="border-t border-gray-200 pt-8">
                    <p class="text-gray-500 text-sm">
                        © 2025 智能穿衣推荐系统 |
                        <a href="#" class="hover:text-primary transition-colors duration-300 mx-1">隐私政策</a> |
                        <a href="#" class="hover:text-primary transition-colors duration-300 mx-1">使用条款</a>
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <!-- 图片预览弹层 -->
    <div id="image-modal" class="fixed inset-0 bg-black/80 z-50 hidden flex items-center justify-center p-4">
        <button id="close-modal" class="absolute top-6 right-6 text-white text-2xl hover:text-gray-300 transition-colors z-10">
            <i class="fa fa-times"></i>
        </button>
        <div class="relative">
            <img id="modal-image" src="" alt="完整图片预览" class="max-w-[90vw] max-h-[90vh] object-contain rounded-lg modal-image-transition">
            <div id="modal-loading" class="absolute inset-0 flex items-center justify-center bg-black/30 hidden">
                <div class="w-12 h-12 border-4 border-white/30 border-t-white rounded-full animate-spin"></div>
            </div>
        </div>
    </div>

    <script>
        // 1. 性别切换控制三围显隐（保留原功能）
        const genderRadios = document.querySelectorAll('input[name="gender"]');
        const bwhFields = document.getElementById('bust-waist-hips');
        if (document.querySelector('input[name="gender"][value="male"]').checked) {
            bwhFields.classList.add('hidden');
            bwhFields.style.opacity = '0';
        }
        genderRadios.forEach(radio => {
            radio.addEventListener('change', () => {
                if (radio.value === 'female') {
                    bwhFields.classList.remove('hidden');
                    setTimeout(() => {
                        bwhFields.style.opacity = '1';
                        bwhFields.style.transform = 'translateY(0)';
                    }, 10);
                } else {
                    bwhFields.style.opacity = '0';
                    bwhFields.style.transform = 'translateY(10px)';
                    setTimeout(() => bwhFields.classList.add('hidden'), 300);
                }
            });
        });

        // 2. 图片上传和拖放处理（保留原功能）
        const faceImageInput = document.getElementById('face-image');
        const dropArea = document.getElementById('drop-area');
        const imagePreviewContainer = document.getElementById('image-preview-container');
        const imagePreview = document.getElementById('image-preview');
        const removeImageBtn = document.getElementById('remove-image');
        const faceImageBase64Input = document.getElementById('face-image-base64');
        const faceImageTypeInput = document.getElementById('face-image-type');
        const faceShapeSelect = document.getElementById('face-shape');

        faceImageInput.addEventListener('change', handleImageUpload);
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, preventDefaults, false);
        });
        function preventDefaults(e) { e.preventDefault(); e.stopPropagation(); }
        ['dragenter', 'dragover'].forEach(eventName => { dropArea.addEventListener(eventName, highlight, false); });
        ['dragleave', 'drop'].forEach(eventName => { dropArea.addEventListener(eventName, unhighlight, false); });
        function highlight() { dropArea.classList.add('drag-over'); }
        function unhighlight() { dropArea.classList.remove('drag-over'); }

        dropArea.addEventListener('drop', handleDrop, false);
        function handleDrop(e) {
            const dt = e.dataTransfer;
            const file = dt.files[0];
            if (file) {
                const dataTransfer = new DataTransfer();
                dataTransfer.items.add(file);
                faceImageInput.files = dataTransfer.files;
                handleImageUpload({ target: faceImageInput });
            }
        }

        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            if (!file.type.startsWith('image/')) { alert('请上传图片文件（支持JPG、PNG）'); return; }
            if (file.size > 10 * 1024 * 1024) { alert('图片大小不能超过10MB'); return; }

            const reader = new FileReader();
            reader.onload = function(e) {
                imagePreview.src = e.target.result;
                imagePreviewContainer.classList.remove('hidden');
                faceImageBase64Input.value = e.target.result;
                faceImageTypeInput.value = file.type;
                faceShapeSelect.value = '';
            };
            reader.readAsDataURL(file);
        }

        removeImageBtn.addEventListener('click', () => {
            imagePreviewContainer.classList.add('hidden');
            faceImageInput.value = '';
            faceImageBase64Input.value = '';
            faceImageTypeInput.value = '';
            imagePreview.src = '';
        });

        faceShapeSelect.addEventListener('change', () => {
            if (faceShapeSelect.value) {
                imagePreviewContainer.classList.add('hidden');
                faceImageInput.value = '';
                faceImageBase64Input.value = '';
                faceImageTypeInput.value = '';
                imagePreview.src = '';
            }
        });

        // 3. 图片预览弹层功能（保留原功能）
        const imageModal = document.getElementById('image-modal');
        const modalImage = document.getElementById('modal-image');
        const closeModal = document.getElementById('close-modal');
        const modalLoading = document.getElementById('modal-loading');

        imagePreview.addEventListener('click', () => {
            const imageSrc = imagePreview.src;
            if (!imageSrc) return;
            modalLoading.classList.remove('hidden');
            modalImage.src = imageSrc;
            imageModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        });

        modalImage.addEventListener('load', () => { modalLoading.classList.add('hidden'); });
        function closeImageModal() {
            imageModal.classList.add('hidden');
            modalImage.src = '';
            modalLoading.classList.add('hidden');
            document.body.style.overflow = '';
        }
        closeModal.addEventListener('click', closeImageModal);
        imageModal.addEventListener('click', (e) => { if (e.target === imageModal) closeImageModal(); });
        document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && !imageModal.classList.contains('hidden')) closeImageModal(); });

        // 4. 表单提交：核心修复：精准控制图像加载状态显示/隐藏
        const styleForm = document.getElementById('style-form');
        const initialState = document.getElementById('initial-state');
        const loadingState = document.getElementById('loading-state');
        const resultState = document.getElementById('result-state');
        const outfitDescription = document.getElementById('outfit-description');
        const styleTips = document.getElementById('style-tips');
        const aiFashionOriginal = document.getElementById('ai-fashion-original');
        // 提前获取图像和加载状态元素（避免重复获取）
        const outfitImage = document.getElementById('outfit-image');
        const imageLoading = document.getElementById('outfit-image-loading');

        styleForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const submitButton = styleForm.querySelector('button[type="submit"]');
            submitButton.classList.add('animate-pulse');

            // 切换状态：显示全局加载，隐藏结果和初始状态
            initialState.classList.add('hidden');
            resultState.classList.add('hidden');
            loadingState.classList.remove('hidden');

            // 收集表单数据
            const formData = new FormData(styleForm);
            const data = Object.fromEntries(formData.entries());
            data.occasion = Array.from(formData.getAll('occasion'));
            if (data.gender !== 'female') { data.bust = ''; data.waist = ''; data.hips = ''; }
            data.faceImageBase64 = faceImageBase64Input.value;
            data.faceImageType = faceImageTypeInput.value;

            try {
                // 发送请求到后端
                const response = await fetch('http://localhost:3001/api/recommend', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (result.success) {
                    // 切换全局状态：隐藏全局加载，显示结果
                    loadingState.classList.add('hidden');
                    resultState.classList.remove('hidden');
                    resultState.style.animation = 'fadeIn 0.5s ease-out';

                    // 1. 渲染穿搭说明
                    outfitDescription.innerHTML = result.description;

                    // 2. 渲染AI穿搭方案原文
                    aiFashionOriginal.textContent = result.fashionRecommendations || '未获取到穿搭方案原文';

                    // 3. 渲染搭配要点
                    styleTips.innerHTML = '';
                    result.tips.forEach((tip, index) => {
                        const li = document.createElement('li');
                        li.className = 'flex items-start';
                        li.innerHTML = `
                            <span class="w-2 h-2 bg-blue-500 rounded-full mt-2 mr-3 flex-shrink-0"></span>
                            <span>${tip}</span>
                        `;
                        li.style.animation = `fadeIn 0.5s ease-out ${index * 0.1}s forwards`;
                        li.style.opacity = '0';
                        styleTips.appendChild(li);
                    });

                    // 4. 核心修复：精准控制图像加载状态
                    if (result.imageProduction.success && result.imageProduction.imageUrls.length > 0) {
                        // 步骤1：显示加载状态，隐藏图像（防止缓存导致的显示异常）
                        imageLoading.classList.remove('hidden');
                        outfitImage.classList.add('hidden');
                        // 步骤2：设置图像src（触发加载）
                        outfitImage.src = result.imageProduction.imageUrls[0];
                        // 步骤3：加载成功后：隐藏加载状态，显示图像
                        outfitImage.onload = function() {
                            imageLoading.classList.add('hidden');
                            outfitImage.classList.remove('hidden');
                        };
                        // 步骤4：加载失败后：隐藏加载状态（避免一直显示）
                        outfitImage.onerror = function() {
                            imageLoading.classList.add('hidden');
                            alert('图像加载失败，请重试');
                        };
                    } else {
                        // 图像生成失败：隐藏加载状态
                        imageLoading.classList.add('hidden');
                        outfitImage.classList.add('hidden');
                    }

                } else {
                    alert(result.message || '获取推荐失败，请重试');
                    // 失败时恢复状态：隐藏加载，显示初始状态
                    loadingState.classList.add('hidden');
                    initialState.classList.remove('hidden');
                }

            } catch (error) {
                console.error('请求错误：', error);
                alert('网络错误，获取推荐失败');
                // 异常时恢复状态：隐藏加载，显示初始状态
                loadingState.classList.add('hidden');
                initialState.classList.remove('hidden');
            } finally {
                // 无论成功/失败，都移除按钮加载状态
                submitButton.classList.remove('animate-pulse');
            }
        });

        // 5. 重新生成按钮：核心修复：同提交逻辑，精准控制加载状态
        document.getElementById('regenerate-btn').addEventListener('click', async () => {
            const btn = document.getElementById('regenerate-btn');
            btn.classList.add('animate-pulse');

            // 步骤1：显示图像加载状态，隐藏图像
            imageLoading.classList.remove('hidden');
            outfitImage.classList.add('hidden');

            try {
                // 收集表单数据（与提交逻辑一致）
                const formData = new FormData(document.getElementById('style-form'));
                const data = Object.fromEntries(formData.entries());
                data.occasion = Array.from(formData.getAll('occasion'));
                if (data.gender !== 'female') { data.bust = ''; data.waist = ''; data.hips = ''; }
                const faceImageBase64Input = document.getElementById('face-image-base64');
                const faceImageTypeInput = document.getElementById('face-image-type');
                data.faceImageBase64 = faceImageBase64Input.value;
                data.faceImageType = faceImageTypeInput.value;

                // 发送重新生成请求
                const response = await fetch('http://localhost:3001/api/recommend', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (result.success) {
                    // 更新穿搭说明
                    document.getElementById('outfit-description').innerHTML = result.description;
                    // 更新方案原文
                    document.getElementById('ai-fashion-original').textContent = result.fashionRecommendations || '未获取到穿搭方案原文';
                    // 更新搭配要点
                    const styleTips = document.getElementById('style-tips');
                    styleTips.innerHTML = '';
                    result.tips.forEach((tip, index) => {
                        const li = document.createElement('li');
                        li.className = 'flex items-start';
                        li.innerHTML = `
                            <span class="w-2 h-2 bg-blue-500 rounded-full mt-2 mr-3 flex-shrink-0"></span>
                            <span>${tip}</span>
                        `;
                        li.style.animation = `fadeIn 0.5s ease-out ${index * 0.1}s forwards`;
                        li.style.opacity = '0';
                        styleTips.appendChild(li);
                    });

                    // 核心修复：更新图像时控制加载状态
                    if (result.imageProduction.success && result.imageProduction.imageUrls.length > 0) {
                        // 先显示加载状态，隐藏图像
                        imageLoading.classList.remove('hidden');
                        outfitImage.classList.add('hidden');
                        // 设置新图像src
                        outfitImage.src = result.imageProduction.imageUrls[0];
                        // 加载成功：隐藏加载，显示图像
                        outfitImage.onload = function() {
                            imageLoading.classList.add('hidden');
                            outfitImage.classList.remove('hidden');
                        };
                        // 加载失败：隐藏加载
                        outfitImage.onerror = function() {
                            imageLoading.classList.add('hidden');
                            alert('图像加载失败，请重试');
                        };
                    } else {
                        // 图像生成失败：隐藏加载
                        imageLoading.classList.add('hidden');
                        outfitImage.classList.add('hidden');
                    }
                } else {
                    alert(result.message || '重新生成失败');
                    // 失败时隐藏加载状态
                    imageLoading.classList.add('hidden');
                }
            } catch (error) {
                console.error('重新生成错误：', error);
                alert('网络错误，重新生成失败');
                // 异常时隐藏加载状态
                imageLoading.classList.add('hidden');
            } finally {
                // 无论成功/失败，都移除按钮加载状态
                btn.classList.remove('animate-pulse');
            }
        });

        // 6. 保存/分享按钮功能（保留原功能）
        document.getElementById('save-btn').addEventListener('click', () => {
            const btn = document.getElementById('save-btn');
            btn.classList.add('animate-pulse');
            setTimeout(() => btn.classList.remove('animate-pulse'), 500);

            const successMsg = document.createElement('div');
            successMsg.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg flex items-center z-50 animate-fade-in';
            successMsg.innerHTML = '<i class="fa fa-check mr-2"></i> 搭配已保存到您的收藏！';
            document.body.appendChild(successMsg);

            setTimeout(() => {
                successMsg.style.animation = 'fadeOut 0.5s ease-out';
                setTimeout(() => document.body.removeChild(successMsg), 500);
            }, 3000);
        });

        document.getElementById('share-btn').addEventListener('click', () => {
            const btn = document.getElementById('share-btn');
            btn.classList.add('animate-pulse');
            setTimeout(() => btn.classList.remove('animate-pulse'), 500);

            const shareOptions = document.createElement('div');
            shareOptions.className = 'fixed top-4 right-4 bg-white p-4 rounded-lg shadow-xl border border-gray-200 z-50 animate-fade-in';
            shareOptions.innerHTML = `
                <div class="flex items-center mb-3">
                    <i class="fa fa-share-alt text-blue-500 mr-2"></i>
                    <span class="font-medium">分享到</span>
                </div>
                <div class="flex space-x-2">
                    <button class="p-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                        <i class="fa fa-wechat"></i>
                    </button>
                    <button class="p-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
                        <i class="fa fa-weibo"></i>
                    </button>
                    <button class="p-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors">
                        <i class="fa fa-whatsapp"></i>
                    </button>
                </div>
            `;
            document.body.appendChild(shareOptions);

            setTimeout(() => {
                document.addEventListener('click', function closeShare(e) {
                    if (!shareOptions.contains(e.target) && e.target !== document.getElementById('share-btn')) {
                        shareOptions.style.animation = 'fadeOut 0.3s ease-out';
                        setTimeout(() => {
                            document.body.removeChild(shareOptions);
                            document.removeEventListener('click', closeShare);
                        }, 300);
                    }
                });
            }, 100);
        });

        // 7. 主题切换（保留原功能）
        const themeToggle = document.getElementById('theme-toggle');
        const icon = themeToggle.querySelector('i');
        themeToggle.addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            if (document.body.classList.contains('dark-mode')) {
                document.body.classList.add('bg-gray-900');
                document.body.classList.remove('bg-gray-50');
                document.querySelectorAll('.bg-white').forEach(el => { el.classList.replace('bg-white', 'bg-gray-800'); });
                document.querySelectorAll('.text-gray-800').forEach(el => { el.classList.replace('text-gray-800', 'text-gray-100'); });
                document.querySelectorAll('.text-gray-600').forEach(el => { el.classList.replace('text-gray-600', 'text-gray-300'); });
                icon.classList.replace('fa-moon-o', 'fa-sun-o');
                icon.classList.add('text-yellow-300');
            } else {
                document.body.classList.remove('bg-gray-900');
                document.body.classList.add('bg-gray-50');
                document.querySelectorAll('.bg-gray-800').forEach(el => { el.classList.replace('bg-gray-800', 'bg-white'); });
                document.querySelectorAll('.text-gray-100').forEach(el => { el.classList.replace('text-gray-100', 'text-gray-800'); });
                document.querySelectorAll('.text-gray-300').forEach(el => { el.classList.replace('text-gray-300', 'text-gray-600'); });
                icon.classList.replace('fa-sun-o', 'fa-moon-o');
                icon.classList.remove('text-yellow-300');
            }
        });

        // 8. 页面加载动画（保留原功能）
        document.addEventListener('DOMContentLoaded', function() {
            const formElements = document.querySelectorAll('#style-form > div');
            formElements.forEach((el, index) => {
                el.style.opacity = '0';
                el.style.transform = 'translateY(20px)';
                setTimeout(() => {
                    el.style.transition = 'all 0.5s ease-out';
                    el.style.opacity = '1';
                    el.style.transform = 'translateY(0)';
                }, index * 100);
            });
        });
    </script>
</body>
</html>